<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roster Configuration Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .player-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        .player-item {
            padding: 8px 12px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .shirt-number {
            background: #007bff;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }
        .config-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            font-size: 12px;
        }
        .btn {
            background: #007bff;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <h1>ðŸ‘¥ Roster Configuration Test</h1>
    
    <div class="test-section">
        <h2>Configuration Status</h2>
        <div id="config-status">Loading...</div>
    </div>

    <div class="test-section">
        <h2>Team Information</h2>
        <div id="team-info">Loading...</div>
    </div>

    <div class="test-section">
        <h2>Roster Settings</h2>
        <div id="roster-settings">Loading...</div>
    </div>

    <div class="test-section">
        <h2>Default Players</h2>
        <div>Total Players: <span id="player-count">0</span></div>
        <div class="player-list" id="player-list">Loading...</div>
    </div>

    <div class="test-section">
        <h2>Actions</h2>
        <button class="btn" onclick="refreshData()">Refresh Data</button>
        <button class="btn" onclick="testRosterUtils()">Test Roster Utils</button>
        <button class="btn" onclick="showRawConfig()">Show Raw Config</button>
    </div>

    <div class="test-section" id="raw-config-section" style="display: none;">
        <h2>Raw Configuration</h2>
        <div class="config-display" id="raw-config"></div>
    </div>

    <script type="module">
        let config = null;
        let rosterUtils = null;

        async function initTest() {
            try {
                // Load config
                const configModule = await import('./js/modules/shared/config.js');
                config = configModule.config;
                await config.load();

                // Load roster utils
                const rosterModule = await import('./js/modules/data/default-roster.js');
                rosterUtils = rosterModule.rosterUtils;

                // Update display
                updateDisplay();

                console.log('Roster test initialized successfully');
            } catch (error) {
                console.error('Test initialization failed:', error);
                document.getElementById('config-status').innerHTML = `<span style="color: red;">Error: ${error.message}</span>`;
            }
        }

        function updateDisplay() {
            try {
                // Config status
                document.getElementById('config-status').innerHTML = config.loaded ? 
                    '<span style="color: green;">âœ“ Configuration loaded successfully</span>' :
                    '<span style="color: orange;">âš  Configuration not fully loaded</span>';

                // Team info
                const teamInfo = `
                    <p><strong>Club Name:</strong> ${config.get('team.clubName', 'Not set')}</p>
                    <p><strong>Season:</strong> ${config.get('team.season', 'Not set')}</p>
                    <p><strong>Age Group:</strong> ${config.get('team.ageGroup', 'Not set')}</p>
                `;
                document.getElementById('team-info').innerHTML = teamInfo;

                // Roster settings
                const rosterSettings = `
                    <p><strong>Max Players:</strong> ${config.get('roster.maxPlayers', 'Not set')}</p>
                    <p><strong>Auto Sort:</strong> ${config.get('roster.autoSort', false) ? 'Yes' : 'No'}</p>
                    <p><strong>Allow Duplicate Numbers:</strong> ${config.get('roster.allowDuplicateNumbers', false) ? 'Yes' : 'No'}</p>
                `;
                document.getElementById('roster-settings').innerHTML = rosterSettings;

                // Default players
                const defaultPlayers = config.get('roster.defaultPlayers', []);
                document.getElementById('player-count').textContent = defaultPlayers.length;

                const playerListHtml = defaultPlayers.map(player => `
                    <div class="player-item">
                        <span>${player.name}</span>
                        ${player.shirtNumber ? `<span class="shirt-number">#${player.shirtNumber}</span>` : '<span style="color: #6c757d;">No #</span>'}
                    </div>
                `).join('');

                document.getElementById('player-list').innerHTML = playerListHtml || '<p>No default players configured</p>';

            } catch (error) {
                console.error('Error updating display:', error);
            }
        }

        window.refreshData = function() {
            updateDisplay();
        };

        window.testRosterUtils = async function() {
            try {
                if (rosterUtils) {
                    const defaultRoster = rosterUtils.getDefaultRoster();
                    const rosterConfig = rosterUtils.getRosterConfig();
                    
                    console.log('Default Roster:', defaultRoster);
                    console.log('Roster Config:', rosterConfig);
                    
                    alert(`Roster Utils Test:\n- Default roster has ${defaultRoster.length} players\n- Auto-sort: ${rosterConfig.autoSort}\n- Max players: ${rosterConfig.maxPlayers}\n\nCheck console for details.`);
                } else {
                    alert('Roster utils not loaded');
                }
            } catch (error) {
                alert('Error testing roster utils: ' + error.message);
                console.error('Roster utils test error:', error);
            }
        };

        window.showRawConfig = function() {
            const section = document.getElementById('raw-config-section');
            const display = document.getElementById('raw-config');
            
            if (section.style.display === 'none') {
                section.style.display = 'block';
                display.textContent = JSON.stringify(config.getAll(), null, 2);
            } else {
                section.style.display = 'none';
            }
        };

        // Initialize test
        initTest();
    </script>
</body>
</html>